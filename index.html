<!DOCTYPE html>
<html lang="es"> 
<head>
    <meta charset="UTF-8">
    <title>Generador de Certificados</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        #certificado-template {
            width: 1200px; padding: 75px; border: 10px double #2c3e50;
            text-align: center; background: white; display: none; position: absolute; left: -9999px;
        }
        .cert-title { font-size: 30px; color: #193756; font-weight: bold; }
        .table-container { margin-top: 20px; }
          /* La imagen flotante */
        .imagen-flotante {
            float: left; /* Hace que el texto fluya a su alrededor */
            margin-right: 20px; /* Espacio entre la imagen y el texto */
            width: 100px; /* Tamaño de ejemplo */
            height: 100px; /* Tamaño de ejemplo */
        }

        /* La imagen con posición absoluta (ejemplo de superposición) */
        .imagen-absoluta {
            position: absolute;
            top: 35px; /* Posición desde el borde superior del contenedor */
            left: 80%; /* Posición desde el borde izquierdo del contenedor */
            width: 180px;
            height: 180px;
            z-index: 1; /* Para asegurar que esté por encima del texto */
        }
        .firma {
            font-family: 'Alex Brush', cursive;
            font-size: 16px; /* Ajusta el tamaño según necesites */
            color: #333;
}
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="card shadow">
        <div class="card-body">
            <h2 class="text-center mb-4">Descarga tu Certificado.</h2>
            <div class="input-group mb-3">
                <input type="text" id="cedula" class="form-control" placeholder="Ingrese su cédula">
                <button class="btn btn-primary" onclick="buscarCursos()">Buscar Cursos</button>
            </div>

            <div class="table-container">
                <table class="table table-hover d-none" id="tabla-resultados">
                    <thead class="table-dark">
                        <tr>
                            <th>Curso</th>
                            <th>Fecha</th>
                            <th>Horas</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpo-tabla"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="certificado-template">
    <span style="color: #004c7e;">
        <h5 class="cert-title">LA SOCIEDAD ANTIOQUEÑA DE </h5>
        <h5 class="cert-title">ANESTESIOLOGÍA Y REANIMACIÓN </h5>
        <h5 class="cert-title">SADEA</h5> 
    </span>
    <img src="https://castrorestrepo.github.io/certificados/LOGO_CLASICO.png" alt="logo_sadea" class="imagen-absoluta">
    <span style="color: #808080;">
        <p class="mt-4">Filial de la Sociedad Antioqueña de Anestesiologíaa y Reanimación S.C.A.R.E.</p>
        <p>Certifica que:</p>    
    </span>
    <p class="mt-4"><h2 id="pdf-nombre" style="text-transform: uppercase; color: #a9883c;"></h2></p>
    <span style="color: #808080;">
        <p class="mt-4">Identificado con el documento número: xxx.xxx.xxx</p>
 
    </span>
    <br>
    <h5 id="pdf-detalles" style="color: #000000;"></h5>
    <p><strong></strong> Modalid de participacion: xxx Estudiante xxxx </p>
   
    <p><strong></strong> <span id="pdf-fecha"></span></p>
    <div class="mt-5" style="display: flex; justify-content: space-around;">
        <div>
            <p class="firma">Mauricio Vasco Ramírez</p>
            <span style="color: #808080; border-top: 1px solid #000; padding-top: 3px;"> <p><strong>PRESIDENTE</strong></p></span>
            
        </div>
        <div>
             <p id="pdf-capacitador" class="firma" ></p>
            <span style="color: #808080; border-top: 1px solid #000; padding-top: 3px;"> <p><strong>VOCAL ACADÉMICO</strong></p></span>
           
        </div>
    </div>
    <span style="color: #808080;">
        <p class="mt-4">Sideseas validar la autenticidad de este certificado, puedes consultarlo en www.sadea.com.co </p>
        <p class="mt-1">en el link de certificados y verifica que corresponda con el serial Número: xxx.xxx.xxx.xxx  </p>
   
        
    </span>
</div>

<script>
    // REEMPLAZA ESTA URL con la de tu Google Apps Script
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyDUMu6PrfkGpyzawARhS6SCz5gkaiWlLa1auyKj71XVj77iD-D4XVz9Oc7Ywn_Uhk/exec";

    async function buscarCursos() {
        const cedula = document.getElementById('cedula').value;
        if (!cedula) return alert("Por favor ingresa una cédula");

        try {
            const resp = await fetch(`${WEB_APP_URL}?cedula=${cedula}`);
            const datos = await resp.json();
            
            const tabla = document.getElementById('tabla-resultados');
            const cuerpo = document.getElementById('cuerpo-tabla');
            cuerpo.innerHTML = "";

            if (datos.length === 0) {
                alert("No se encontraron registros");
                tabla.classList.add('d-none');
                return;
            }

            datos.forEach(item => {
                const fila = `<tr>
                    <td>${item.curso}</td>
                    <td>${item.fecha}</td>
                    <td>${item.horas}</td>
                    <td><button class="btn btn-sm btn-success" onclick='generarPDF(${JSON.stringify(item)})'>Descargar</button></td>
                </tr>`;
                cuerpo.innerHTML += fila;
            });
            tabla.classList.remove('d-none');
        } catch (e) {
            console.error(e);
            alert("Error al conectar con la base de datos");
        }
    }

    async function generarPDF(datos) {
        const { jsPDF } = window.jspdf;
        
        // Llenar la plantilla oculta
        document.getElementById('pdf-nombre').innerText = datos.nombre;
      //  document.getElementById('pdf-curso').innerText = datos.curso;
        document.getElementById('pdf-detalles').innerText = datos.detalles;
      //  document.getElementById('pdf-horas').innerText = datos.horas;
        document.getElementById('pdf-fecha').innerText = datos.fecha;
        document.getElementById('pdf-capacitador').innerText = datos.capacitador;
        
        const element = document.getElementById('certificado-template');
        element.style.display = 'block'; // Mostrar temporalmente para renderizar

        const canvas = await html2canvas(element);
        const imgData = canvas.toDataURL('image/png');
        
        const pdf = new jsPDF('l', 'mm', 'a4'); // Orientación Horizontal (Landscape)
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        pdf.save(`Certificado_${datos.curso}_${datos.nombre}.pdf`);
        
        element.style.display = 'none'; // Volver a ocultar
    }
</script>
</body>
</html>